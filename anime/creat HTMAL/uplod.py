from github import Github
import base64
import os
import threading
import tkinter as tk
from tkinter import filedialog, messagebox, ttk

# بيانات المستخدم (ضع هنا التوكن والريبو الخاص بك)
access_token = "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"
repo_name = "abdo12249/1"
upload_base_path = "anime"  # المجلد داخل الريبو

# الاتصال بـ GitHub
g = Github(access_token)
repo = g.get_repo(repo_name)

def upload_file(local_path, remote_path):
    with open(local_path, "rb") as f:
        content = f.read()
        encoded = base64.b64encode(content).decode()

    try:
        contents = repo.get_contents(remote_path, ref="main")
        repo.update_file(remote_path, "تحديث الملف عبر Python", encoded, contents.sha, branch="main")
        return f"✅ تحديث: {remote_path}"
    except Exception as e:
        try:
            repo.create_file(remote_path, "رفع ملف جديد عبر Python", encoded, branch="main")
            return f"✅ رفع جديد: {remote_path}"
        except Exception as ex:
            return f"❌ خطأ في رفع {remote_path}: {ex}"

def start_upload(local_folder_path, progress_var, status_label, root):
    if not os.path.exists(local_folder_path):
        messagebox.showerror("خطأ", "المسار غير موجود!")
        return

    parent_local_folder = os.path.dirname(local_folder_path)
    all_files = []
    for root_dir, dirs, files in os.walk(local_folder_path):
        for file in files:
            full_local_path = os.path.join(root_dir, file)
            relative_path = os.path.relpath(full_local_path, parent_local_folder)
            remote_path = f"{upload_base_path}/{relative_path}".replace("\\", "/")
            all_files.append((full_local_path, remote_path))

    total_files = len(all_files)
    if total_files == 0:
        messagebox.showinfo("معلومة", "لا توجد ملفات في المجلد المختار")
        return

    for i, (local_path, remote_path) in enumerate(all_files):
        status = upload_file(local_path, remote_path)
        status_label.config(text=status)
        progress_var.set(int((i + 1) / total_files * 100))
        root.update_idletasks()

    messagebox.showinfo("انتهاء", "تم رفع جميع الملفات!")

def choose_folder(progress_var, status_label, root):
    folder_path = filedialog.askdirectory()
    if folder_path:
        status_label.config(text="جاري الرفع...")
        threading.Thread(target=start_upload, args=(folder_path, progress_var, status_label, root), daemon=True).start()

def main():
    root = tk.Tk()
    root.title("رفع الملفات إلى GitHub")

    root.geometry("400x180")
    root.resizable(False, False)

    btn_choose = tk.Button(root, text="اختر مجلد للرفع", command=lambda: choose_folder(progress_var, label_status, root))
    btn_choose.pack(pady=20)

    progress_var = tk.IntVar()
    progress_bar = ttk.Progressbar(root, orient="horizontal", length=300, mode="determinate", variable=progress_var, maximum=100)
    progress_bar.pack(pady=10)

    label_status = tk.Label(root, text="انتظر حتى تختار مجلد...")
    label_status.pack()

    root.mainloop()

if __name__ == "__main__":
    main()
