<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>أحدث حلقات</title>
<link rel="stylesheet" href="/CSS/style.css" />
<script src="navbar.js" defer></script>
<link rel="icon" href="https://abdo12249.github.io/1/navbar/favicon.ico" type="image/x-icon" />

<style>
/* Pagination styling */
.pagination { display: flex; justify-content: center; flex-wrap: wrap; gap: 8px; margin: 20px 0; }
.pagination button { padding: 6px 12px; background-color: var(--primary-color, #ef4444); color: white; border: none; cursor: pointer; border-radius: 6px; transition: background-color 0.3s ease; }
.pagination button:hover { background-color: #dc2626; }
.pagination button.active { background-color: #b91c1c; }
.pagination span { padding: 6px 12px; color: #888; }

/* Loading overlay */
.loading-overlay {
  position: fixed; top: 0; left: 0; width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.7); display: flex; flex-direction: column;
  justify-content: center; align-items: center; z-index: 1000; color: white; font-size: 1.2em;
}
.spinner {
  border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid #fff;
  border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px;
}
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.anime-image img.loaded { opacity: 1; }

/* small helper for debug buttons (optional) */
.controls { display:flex; gap:8px; justify-content:center; margin:12px 0; }
.controls button { padding:8px 12px; border-radius:6px; border:none; cursor:pointer; background:#ef4444; color:#fff;}
.controls button:hover{opacity:0.9;}
</style>
</head>
<body>

<div id="navbar-container"></div>

<main>
  <div class="section-header">
    <h1>أحدث حلقات</h1>
  </div>

  <div class="anime-grid" id="animeGrid"></div>
  <div class="pagination" id="pagination"></div>

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="loading-overlay" style="display: none;">
    <div class="spinner"></div>
    <span id="loadingText">جاري تحميل الأنمي...</span>
  </div>

<script>
const ITEMS_PER_PAGE = 30; // عدد الحلقات في كل صفحة
let allEpisodes = [];

async function loadEpisodes() {
  try {
    const response = await fetch("الجديد.json");
    allEpisodes = await response.json();

    // عكس الترتيب بحيث آخر حلقة تظهر أولاً
    allEpisodes = allEpisodes.slice().reverse();

    const urlParams = new URLSearchParams(window.location.search);
    const currentPage = parseInt(urlParams.get("page")) || 1;

    renderPage(currentPage);
    renderPagination(currentPage);

  } catch (error) {
    console.error("خطأ في تحميل الجديد.json:", error);
  }
}

function renderPage(page) {
  const animeGrid = document.getElementById("animeGrid");
  animeGrid.innerHTML = "";

  const start = (page - 1) * ITEMS_PER_PAGE;
  const end = start + ITEMS_PER_PAGE;

  const list = allEpisodes.slice(start, end);

  list.forEach(ep => {
    const card = document.createElement("div");
    card.className = "anime-card";

    card.innerHTML = `
      <div class="anime-image">
        <img src="${ep.image}" alt="${ep.animeTitle}" loading="lazy">
      </div>
      <div class="anime-info">
        <h3>${ep.animeTitle}</h3>
        <div class="anime-meta">
          <span>${ep.title}</span>
          <a href="${ep.link}" class="watch-button">شاهد الآن</a>
        </div>
      </div>
    `;
    animeGrid.appendChild(card);
  });
}

function renderPagination(currentPage) {
  const pagination = document.getElementById("pagination");
  pagination.innerHTML = "";

  const totalPages = Math.ceil(allEpisodes.length / ITEMS_PER_PAGE);

  // الصفحة 1–5
  for (let i = 1; i <= 5; i++) {
    if (i > totalPages) break;

    const btn = document.createElement("button");
    btn.className = "watch-button" + (i === currentPage ? " active" : "");
    btn.textContent = i;
    btn.onclick = () => goToPage(i);
    pagination.appendChild(btn);
  }

  // النقاط ... لو فيه صفحات كتير
  if (totalPages > 6) {
    const dots = document.createElement("span");
    dots.textContent = "...";
    pagination.appendChild(dots);
  }

  // آخر صفحة
  if (totalPages > 5) {
    const lastBtn = document.createElement("button");
    lastBtn.className = "watch-button";
    lastBtn.textContent = totalPages;
    lastBtn.onclick = () => goToPage(totalPages);
    pagination.appendChild(lastBtn);
  }

  // زر التالي →
  if (currentPage < totalPages) {
    const nextBtn = document.createElement("button");
    nextBtn.className = "watch-button";
    nextBtn.textContent = "التالي →";
    nextBtn.onclick = () => goToPage(currentPage + 1);
    pagination.appendChild(nextBtn);
  }
}

function goToPage(page) {
  window.location.href = `new.html?page=${page}`;
}

loadEpisodes();
</script>


</main>

<script>
fetch('navbar.html')
  .then(res=>res.text())
  .then(data=>document.getElementById('navbar-container').innerHTML=data)
  .catch(err=>console.error("خطأ في تحميل شريط التنقل:", err));
</script>

</main>
</body>
</html>




