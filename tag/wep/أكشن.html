<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>تصنيفات الأنمي</title>
  <link rel="stylesheet" href="../../CSS/style.css" />
  <script src="../../navbar.js" defer></script>
  <link rel="icon" href="https://abdo12249.github.io/1/navbar/favicon.ico" type="image/x-icon" />
</head>

<body>
  <div id="navbar-container"></div>

  <main>
    <div class="section-header">
      <h1>تصنيفات الأنمي</h1>
    </div>

    <!-- أزرار التصنيفات -->
    <div id="categoryButtons">
      <button class="watch-button" onclick="filterAnime('all')">عرض الكل</button>
    </div>

    <!-- شبكة الأنميات -->
    <div class="anime-grid" id="animeGrid"></div>
  </main>

  <script>
    let allAnimes = []; // تخزين كل الأنميات

    // تحميل ملف واحد فقط (animes.json)
    async function loadAnimeData() {
      try {
        const response = await fetch("https://abdo12249.github.io/1/test1/animes.json");
        if (!response.ok) throw new Error("❌ فشل تحميل animes.json");

        const data = await response.json();
        const animeList = Object.entries(data).map(([id, anime]) => ({ id, ...anime }));
        allAnimes = animeList;

        animeList.forEach(anime => displayAnime(anime));
        generateCategoryButtons();
      } catch (error) {
        console.error("❌ خطأ في تحميل الأنميات:", error);
      }
    }

    // عرض الأنمي في البطاقة
    function displayAnime(anime) {
      const animeGrid = document.getElementById('animeGrid');

      const card = document.createElement('div');
      card.className = 'anime-card';
      const categories = anime.tags || anime.categories || [];

      card.setAttribute('data-categories', categories.join(','));

      const link = `../../test1/Anime Page Dynamic.html?id=${anime.id}`;

      card.innerHTML = `
        <a href="${link}" style="text-decoration: none; color: inherit;">
          <div class="anime-image">
            <img src="${adjustPath(anime.image)}" alt="${anime.title}" loading="lazy" />
          </div>
          <div class="anime-info">
            <h3>${anime.title}</h3>
            <p>${anime.description || ''}</p>
            <div class="anime-meta">
              <span><strong>التصنيفات:</strong> ${categories.join(', ')}</span>
              <span><strong>الموسم:</strong> ${anime.season || 'غير متوفر'}</span>
              <span><strong>المدة:</strong> ${anime.duration || 'غير معروفة'}</span>
              <span><strong>الحالة:</strong> ${anime.status || 'غير معروف'}</span>
              <span class="watch-button">شاهد الآن</span>
            </div>
          </div>
        </a>
      `;
      animeGrid.appendChild(card);
    }
function adjustPath(path) {
  // لو المسار يبدأ بـ ../ حوّله إلى ../../
  if (path.startsWith('../')) {
    return path.replace('../', '../../');
  }
  return path;
}

    // توليد أزرار التصنيفات تلقائيًا
    function generateCategoryButtons() {
      const categories = new Set();
      allAnimes.forEach(anime => {
        const tags = anime.tags || anime.categories || [];
        tags.forEach(cat => categories.add(cat));
      });

      const container = document.getElementById('categoryButtons');
      categories.forEach(category => {
        const button = document.createElement('button');
        button.className = "watch-button";
        button.textContent = category;
        button.onclick = () => filterAnime(category);
        container.appendChild(button);
      });
      document.querySelector('#categoryButtons .watch-button').classList.add('active');
    }

    // فلترة الأنميات حسب التصنيف
    function filterAnime(category) {
    // إزالة الكلاس active من كل الأزرار
    const allButtons = document.querySelectorAll('#categoryButtons .watch-button');
    allButtons.forEach(btn => btn.classList.remove('active'));

    // تحديد الزر المطابق وإضافة الكلاس
    allButtons.forEach(btn => {
        if (btn.textContent.trim() === category || (category === 'all' && btn.textContent.trim() === "عرض الكل")) {
        btn.classList.add('active');
        }
    });

    // فلترة البطاقات
    const cards = document.querySelectorAll('.anime-card');
    cards.forEach(card => {
        const cardCategories = card.getAttribute('data-categories').split(',');
        if (category === 'all' || cardCategories.includes(category)) {
        card.style.display = 'block';
        } else {
        card.style.display = 'none';
        }
    });
    }


    // تحميل البيانات عند فتح الصفحة
    loadAnimeData();
  </script>

  <script>
    // تحميل الشريط العلوي
    fetch('../../navbar.html')
      .then(response => response.text())
      .then(data => document.getElementById('navbar-container').innerHTML = data)
      .catch(error => console.error('❌ خطأ في تحميل الشريط العلوي:', error));
  </script>
</body>

</html>
