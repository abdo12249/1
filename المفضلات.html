<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</title>
    <link rel="stylesheet" href="CSS/style.css">
    <script src="navbar.js" defer></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 120px;
        }
        ul {
            list-style-type: none;
            padding: 0;
        }
        li {
            margin: 10px 0;
        }
        a {
            text-decoration: none;
            color: blue;
            font-size: 18px;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        input {
            padding: 8px;
            margin: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div id="navbar-container"></div>
    <h1>Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h1>

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯ -->
    <input type="text" id="siteTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹">
    <input type="text" id="siteURL" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹">
    <button onclick="addLink()">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹</button>

    <ul id="linksList"></ul>
    <button onclick="clearLinks()">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹</button>

    <script type="module">
        // ------------------ Firebase Config ------------------
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getDatabase, ref, set, get, child, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

        const firebaseConfig = {
          apiKey: "AIzaSyAQpXUUOLyN2B6IWGb5Ru2Dl8NZPNimTEg",
          authDomain: "wep1-25124.firebaseapp.com",
          databaseURL: "https://wep1-25124-default-rtdb.firebaseio.com",
          projectId: "wep1-25124",
          storageBucket: "wep1-25124.firebasestorage.app",
          messagingSenderId: "400763524699",
          appId: "1:400763524699:web:b3d5b77815de059ad9117e",
          measurementId: "G-ER2GCC7BK4"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        let currentUser = null;

        // ğŸŸ¢ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        function loadLinks() {
            let list = document.getElementById("linksList");
            list.innerHTML = "";

            if (currentUser) {
                const dbRef = ref(db, "savedSites/" + currentUser.uid);
                get(dbRef).then(snapshot => {
                    if (snapshot.exists()) {
                        let savedSites = snapshot.val();
                        renderLinks(savedSites);
                    }
                });
            } else {
                let savedSites = localStorage.getItem("savedSites") ? JSON.parse(localStorage.getItem("savedSites")) : [];
                renderLinks(savedSites);
            }
        }

        // ğŸŸ¢ Ø¹Ø±Ø¶ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·
        function renderLinks(savedSites) {
            let list = document.getElementById("linksList");
            list.innerHTML = "";
            savedSites.forEach(site => {
                let listItem = document.createElement("li");
                let anchor = document.createElement("a");
                anchor.href = site.url;
                anchor.textContent = site.title;
                anchor.target = "_blank";
                listItem.appendChild(anchor);
                list.appendChild(listItem);
            });
        }

        // ğŸŸ¢ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙŠØ¯
        function addLink() {
            let title = document.getElementById("siteTitle").value.trim();
            let url = document.getElementById("siteURL").value.trim();
            if (!title || !url) return alert("Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„Ø±Ø§Ø¨Ø·");

            if (currentUser) {
                const dbRef = ref(db, "savedSites/" + currentUser.uid);
                get(dbRef).then(snapshot => {
                    let savedSites = snapshot.exists() ? snapshot.val() : [];
                    savedSites.push({ title, url });
                    set(dbRef, savedSites).then(() => loadLinks());
                });
            } else {
                let savedSites = localStorage.getItem("savedSites") ? JSON.parse(localStorage.getItem("savedSites")) : [];
                savedSites.push({ title, url });
                localStorage.setItem("savedSites", JSON.stringify(savedSites));
                loadLinks();
            }

            document.getElementById("siteTitle").value = "";
            document.getElementById("siteURL").value = "";
        }

        // ğŸŸ¢ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹
        function clearLinks() {
            if (currentUser) {
                remove(ref(db, "savedSites/" + currentUser.uid));
            } else {
                localStorage.removeItem("savedSites");
            }
            loadLinks();
        }

        // ğŸŸ¢ Ù…ØªØ§Ø¨Ø¹Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            loadLinks();
        });

        // ğŸŸ¢ Ø±Ø¨Ø· Ø§Ù„Ø¯ÙˆØ§Ù„ Ø¨Ù€ window
        window.addLink = addLink;
        window.clearLinks = clearLinks;
    </script>

    <script>
        fetch('navbar.html')
            .then(response => response.text())
            .then(data => document.getElementById('navbar-container').innerHTML = data);
    </script>
</body>
</html>
